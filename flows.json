[{"id":"8f8f43f7.01481","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"960d5a8b.8e7398","type":"tab","label":"Water","disabled":false,"info":""},{"id":"865fb592.2877c8","type":"mqtt-broker","z":"","name":"localhost-mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"326bb2da.30ab9e","type":"ui_tab","z":"","name":"Tab1","icon":"dashboard","disabled":false,"hidden":false},{"id":"cfef9cf7.e793b","type":"ui_group","z":"","name":"Water Monitoring","tab":"326bb2da.30ab9e","disp":true,"width":"6","collapse":false},{"id":"bfdade84.fd41d","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#4B7930","value":"#4B7930","edited":false},"page-titlebar-backgroundColor":{"value":"#4B7930","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#6db046","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#4b7930","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"true","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"8a457ff5.55c5e","type":"ui_tab","z":"","name":"Water","icon":"dashboard","disabled":false,"hidden":false},{"id":"52e438cf.a42268","type":"ui_group","z":"","name":"Water options","tab":"8a457ff5.55c5e","disp":true,"width":"6","collapse":false},{"id":"5c87f508.f134ec","type":"ui_group","z":"","name":"Custom Widget","tab":"326bb2da.30ab9e","disp":true,"width":"6","collapse":false},{"id":"f8c4a64c.43daf8","type":"inject","z":"8f8f43f7.01481","name":"","topic":"water","payload":"","payloadType":"str","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":140,"wires":[["c7f2f80d.b71498"]]},{"id":"3989bd20.f78b52","type":"uibuilder","z":"8f8f43f7.01481","name":"react_ui","topic":"","url":"react_ui","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"debugFE":false,"copyIndex":false,"template":"","x":500,"y":140,"wires":[[],[]]},{"id":"c7f2f80d.b71498","type":"function","z":"8f8f43f7.01481","name":"Random","func":"rnd = (Math.random() * 3).toFixed(1);\nmsg.payload = rnd;\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":60,"wires":[["e83a242c.9a01e8"]]},{"id":"e83a242c.9a01e8","type":"debug","z":"8f8f43f7.01481","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":220,"wires":[]},{"id":"b3d6917b.b6e0a","type":"ui_text","z":"960d5a8b.8e7398","group":"cfef9cf7.e793b","order":2,"width":0,"height":0,"name":"","label":"Current flow rate is ","format":"{{msg.payload}} liter/minute","layout":"row-center","x":530,"y":200,"wires":[]},{"id":"1e91f9e4.634226","type":"ui_chart","z":"960d5a8b.8e7398","name":"","group":"cfef9cf7.e793b","order":1,"width":0,"height":0,"label":"","chartType":"line","legend":"false","xformat":"mm:ss","interpolate":"bezier","nodata":"No data.","dot":false,"ymin":"0","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":490,"y":240,"wires":[[]]},{"id":"70f07fbb.fd928","type":"ui_button","z":"960d5a8b.8e7398","name":"","group":"cfef9cf7.e793b","order":5,"width":"2","height":"1","passthru":false,"label":"Advanced","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"tab\":\"Water\"}","payloadType":"json","topic":"","x":100,"y":600,"wires":[["2c8998a6.7ecd08"]]},{"id":"671ec813.97d3f8","type":"ui_text","z":"960d5a8b.8e7398","group":"52e438cf.a42268","order":4,"width":0,"height":0,"name":"","label":"Water options","format":"{{msg.payload}}","layout":"row-spread","x":520,"y":400,"wires":[]},{"id":"24dc4c67.4103f4","type":"mqtt out","z":"960d5a8b.8e7398","name":"","topic":"water_monitor/valve_control","qos":"","retain":"","broker":"865fb592.2877c8","x":900,"y":340,"wires":[]},{"id":"77cec268.a1011c","type":"mqtt out","z":"960d5a8b.8e7398","name":"","topic":"water_monitor/config","qos":"","retain":"","broker":"865fb592.2877c8","x":880,"y":520,"wires":[]},{"id":"992ceb5.f73f818","type":"mqtt out","z":"960d5a8b.8e7398","name":"","topic":"water_monitor/status_request","qos":"","retain":"","broker":"865fb592.2877c8","x":910,"y":460,"wires":[]},{"id":"2c8998a6.7ecd08","type":"ui_ui_control","z":"960d5a8b.8e7398","name":"","x":500,"y":600,"wires":[[]]},{"id":"1ca8d074.4a80f","type":"ui_text","z":"960d5a8b.8e7398","group":"cfef9cf7.e793b","order":3,"width":0,"height":0,"name":"","label":"Valve is ","format":"{{msg.payload}}","layout":"row-left","x":500,"y":300,"wires":[]},{"id":"a6b4052d.83f7c8","type":"ui_button","z":"960d5a8b.8e7398","name":"","group":"cfef9cf7.e793b","order":4,"width":0,"height":0,"passthru":false,"label":"{{msg.payload}}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"button_cmd","payloadType":"flow","topic":"","x":690,"y":340,"wires":[["24dc4c67.4103f4","5bb05ddf.636e64"]]},{"id":"641f97bc.a21fe8","type":"function","z":"960d5a8b.8e7398","name":"set button text","func":"var newMsg;\nif (msg.payload == \"open\"){\n    flow.set(\"button_cmd\", \"close\");\n    newMsg = { payload: \"close\", \n                enabled: true };\n} else if (msg.payload == \"closed\"){\n    flow.set(\"button_cmd\", \"open\");\n    newMsg = { payload: \"open\",\n                enabled: true };\n} else if (msg.payload == \"closing\") {\n    flow.set(\"button_cmd\", \"open\");\n    newMsg = { payload: \"open\",\n                enabled: true };\n} else if (msg.payload == \"opening\") {\n    flow.set(\"button_cmd\", \"close\");\n    newMsg = { payload: \"close\",\n                enabled: true };\n}\nreturn newMsg;","outputs":1,"noerr":0,"x":520,"y":340,"wires":[["a6b4052d.83f7c8"]]},{"id":"f9323c77.3a6d1","type":"switch","z":"960d5a8b.8e7398","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"water_monitor/flow_meter","vt":"str"},{"t":"eq","v":"water_monitor/valve_status","vt":"str"},{"t":"eq","v":"water_monitor/config_status","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":290,"y":260,"wires":[["b3d6917b.b6e0a","1e91f9e4.634226","9e917171.007cd"],["1ca8d074.4a80f","641f97bc.a21fe8"],["671ec813.97d3f8"]]},{"id":"ad492a61.1c54d8","type":"mqtt in","z":"960d5a8b.8e7398","name":"","topic":"water_monitor/#","qos":"0","datatype":"auto","broker":"865fb592.2877c8","x":120,"y":260,"wires":[["f9323c77.3a6d1","e199f265.47ce6"]]},{"id":"80f459a9.9dd6f8","type":"inject","z":"960d5a8b.8e7398","name":"on startup","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"0","x":130,"y":40,"wires":[["4123a6a8.b1dac8"]]},{"id":"922e897f.95aa08","type":"function","z":"960d5a8b.8e7398","name":"when reconnected","func":"if (msg.payload == \"no timeout\") {\n    flow.set(\"water_monitor_online\", true);\n    //var newMsg = { payload: flow.get(\"wm_config_payload\")};\n    return { payload: flow.get(\"wm_config_payload\")};\n} else if (msg.payload == \"timeout\") {\n    flow.set(\"water_monitor_online\", false);\n    return null;\n}","outputs":1,"noerr":0,"x":530,"y":520,"wires":[["77cec268.a1011c","422a397b.8809a8"]]},{"id":"4123a6a8.b1dac8","type":"function","z":"960d5a8b.8e7398","name":"set vars","func":"flow.set(\"reports_per_second\", 2);\nflow.set(\"calibration_factor\", 4.556);\nflow.set(\"wm_config_payload\", \"reports_per_second:\"+flow.get(\"reports_per_second\")+\n    \";calibration_factor:\"+flow.get(\"calibration_factor\"));\n//return { payload: flow.get(\"wm_config_payload\") };","outputs":1,"noerr":0,"x":300,"y":40,"wires":[[]]},{"id":"e199f265.47ce6","type":"timeout","z":"960d5a8b.8e7398","name":"timeout","outtopic":"","outsafe":"no timeout","outwarning":"Warning","outunsafe":"timeout","warning":"0","timer":"5","repeat":false,"again":false,"x":300,"y":520,"wires":[["922e897f.95aa08"]]},{"id":"422a397b.8809a8","type":"change","z":"960d5a8b.8e7398","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"none","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":460,"wires":[["992ceb5.f73f818"]]},{"id":"d525f15b.fe5f6","type":"function","z":"960d5a8b.8e7398","name":"update vars","func":"if(msg.topic == \"reports_per_second\") {\n    flow.set(\"reports_per_second\", msg.payload);\n    flow.set(\"wm_config_payload\", \"reports_per_second:\"+flow.get(\"reports_per_second\")+\n    \";calibration_factor:\"+flow.get(\"calibration_factor\"));\n} else if (msg.topic == \"calibration_factor\") {\n    flow.set(\"calibration_factor\", msg.payload);\n    flow.set(\"wm_config_payload\", \"reports_per_second:\"+flow.get(\"reports_per_second\")+\n    \";calibration_factor:\"+flow.get(\"calibration_factor\"));\n}\nreturn { payload: flow.get(\"wm_config_payload\")};","outputs":1,"noerr":0,"x":510,"y":660,"wires":[["77cec268.a1011c"]]},{"id":"95464204.fe3ce","type":"ui_numeric","z":"960d5a8b.8e7398","name":"","label":"reports / second","tooltip":"","group":"52e438cf.a42268","order":3,"width":0,"height":0,"passthru":true,"topic":"reports_per_second","format":"{{value}}","min":0,"max":10,"step":1,"x":120,"y":660,"wires":[["d525f15b.fe5f6"]]},{"id":"21a9cac4.730946","type":"ui_numeric","z":"960d5a8b.8e7398","name":"","label":"calibration factor","tooltip":"","group":"52e438cf.a42268","order":5,"width":0,"height":0,"passthru":true,"topic":"calibration_factor","format":"{{value}}","min":0,"max":10,"step":1,"x":130,"y":700,"wires":[["d525f15b.fe5f6"]]},{"id":"5bb05ddf.636e64","type":"debug","z":"960d5a8b.8e7398","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":880,"y":260,"wires":[]},{"id":"9e917171.007cd","type":"link out","z":"960d5a8b.8e7398","name":"Water flow","links":["820ba66b.ca0938"],"x":760,"y":160,"wires":[]},{"id":"820ba66b.ca0938","type":"link in","z":"8f8f43f7.01481","name":"","links":["9e917171.007cd"],"x":80,"y":240,"wires":[["3989bd20.f78b52"]]}]